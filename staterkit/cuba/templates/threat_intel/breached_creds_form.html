{% extends "base.html" %}

{% block content %}
<div class="container-fluid">
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <h5>{% if breached_cred %}Edit{% else %}Add{% endif %} Breached Credential</h5>
          <p class="f-m-light mt-1 mb-0">Fill in the details below. Fields marked with <span class="text-danger">*</span> are required.</p>
          <div class="card-header-right">
            <a href="{{ url_for('threat_intel.breached_creds_list') }}" class="btn btn-secondary btn-sm">
              <i data-feather="arrow-left" style="width: 14px; height: 14px;"></i> Back
            </a>
          </div>
        </div>
        <div class="card-body">
          <div class="card-wrapper border rounded-3">
          <form class="row g-3" method="POST" action="{% if breached_cred %}{{ url_for('threat_intel.breached_creds_edit', id=breached_cred.id) }}{% else %}{{ url_for('threat_intel.breached_creds_add') }}{% endif %}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>

              <div class="col-md-6">
                  <label class="form-label" for="username">Username</label>
                  <input class="form-control" id="username" name="username" type="text" 
                         value="{{ breached_cred.username if breached_cred else '' }}" 
                         placeholder="Enter username" />
              </div>
              <div class="col-md-6">
                  <label class="form-label" for="domain">Domain</label>
                  <input class="form-control" id="domain" name="domain" type="text" 
                         value="{{ breached_cred.domain if breached_cred else '' }}" 
                         placeholder="Enter domain" />
              </div>

              <div class="col-md-6">
                  <label class="form-label" for="password">Password</label>
                  <input class="form-control" id="password" name="password" type="password" 
                         value="{{ breached_cred.password if breached_cred else '' }}" 
                         placeholder="Enter password" />
                  <small class="form-text text-muted">Password will be masked in the view but stored as plain text.</small>
              </div>
              <div class="col-md-6">
                  <label class="form-label" for="source">Source</label>
                  <input class="form-control" id="source" name="source" type="text" 
                         value="{{ breached_cred.source if breached_cred else '' }}" 
                         placeholder="Enter source" />
              </div>

              <div class="col-md-6">
                  <label class="form-label" for="type">Type</label>
                  <select class="form-control" id="type" name="type">
                    <option value="">Select Type</option>
                    <option value="combolist" {% if breached_cred and breached_cred.type == 'combolist' %}selected{% endif %}>Combolist</option>
                    <option value="stealer" {% if breached_cred and breached_cred.type == 'stealer' %}selected{% endif %}>Stealer</option>
                    <option value="malware" {% if breached_cred and breached_cred.type == 'malware' %}selected{% endif %}>Malware</option>
                    <option value="pastebin" {% if breached_cred and breached_cred.type == 'pastebin' %}selected{% endif %}>Pastebin</option>
                    <option value="breach" {% if breached_cred and breached_cred.type == 'breach' %}selected{% endif %}>Breach</option>
                    <option value="phishing" {% if breached_cred and breached_cred.type == 'phishing' %}selected{% endif %}>Phishing</option>
                    <option value="darkweb" {% if breached_cred and breached_cred.type == 'darkweb' %}selected{% endif %}>Darkweb</option>
                  </select>
              </div>
              <div class="col-md-6">
                  <label class="form-label" for="url">URL</label>
                  <input class="form-control" id="url" name="url" type="url" 
                         value="{{ breached_cred.url if breached_cred else '' }}" 
                         placeholder="Enter URL" />
              </div>

              <div class="col-md-4">
                  <label class="form-label" for="_id">ID</label>
                  <input class="form-control" id="_id" name="_id" type="text" 
                         value="{{ breached_cred._id if breached_cred else '' }}" 
                         placeholder="Enter ID" />
              </div>
              <div class="col-md-4">
                  <label class="form-label" for="_index">Index</label>
                  <input class="form-control" id="_index" name="_index" type="text" 
                         value="{{ breached_cred._index if breached_cred else '' }}" 
                         placeholder="Enter index" />
              </div>
              <div class="col-md-4">
                  <label class="form-label" for="_score">Score</label>
                  <input class="form-control" id="_score" name="_score" type="number" step="0.01" 
                         value="{{ breached_cred._score if breached_cred and breached_cred._score is not none else '' }}" 
                         placeholder="Enter score" />
              </div>

              <div class="col-md-6">
                  <label class="form-label" for="_ignored">Ignored</label>
                  <select class="form-control" id="_ignored" name="_ignored">
                    <option value="0" {% if not breached_cred or not breached_cred._ignored %}selected{% endif %}>No</option>
                    <option value="1" {% if breached_cred and breached_cred._ignored %}selected{% endif %}>Yes</option>
                  </select>
              </div>

              <div class="col-12">
                <div class="d-flex gap-2">
                  <button class="btn btn-primary btn-sm" type="submit">{% if breached_cred %}Update{% else %}Add{% endif %} Breached Credential</button>
                  <a href="{{ url_for('threat_intel.breached_creds_list') }}" class="btn btn-secondary btn-sm">Cancel</a>
                </div>
              </div>
          </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

